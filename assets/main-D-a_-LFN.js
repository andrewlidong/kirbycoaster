import{V as a,C as F,T as W,M as w,D as J,a as h,b as V,G as I,S as C,c as j,O as B,P as Y,d as $,e as tt,f as et,W as st,g as nt,A as ot,h as it}from"./three-cwk2hcMp.js";import{p as at}from"./p5-BtJWWB7g.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class rt{constructor(t){this.scene=t,this.createTrack()}createTrack(){const t=[];t.push(new a(0,5,0)),t.push(new a(10,5,0)),t.push(new a(20,15,0)),t.push(new a(30,20,0)),t.push(new a(40,15,10)),t.push(new a(50,10,20)),t.push(new a(40,8,30)),t.push(new a(20,8,35)),t.push(new a(0,12,30)),t.push(new a(-20,15,20)),t.push(new a(-30,18,0)),t.push(new a(-20,12,-20)),t.push(new a(0,8,-30)),t.push(new a(20,6,-20)),t.push(new a(30,5,-10)),t.push(new a(20,5,0)),t.push(new a(10,5,0)),t.push(new a(0,5,0)),this.spline=new F(t),this.spline.closed=!0,this.createMainTrack(),this.createRails(),this.createSupports()}createMainTrack(){const t=new W(this.spline,200,.5,16,!0),e=new w({color:16758749,specular:16777215,shininess:50,side:J});this.mainTrack=new h(t,e),this.mainTrack.castShadow=!0,this.mainTrack.receiveShadow=!0,this.scene.add(this.mainTrack)}createRails(){const o=new w({color:16751052,specular:16777215,shininess:100}),s=[],n=[];for(let g=0;g<=200;g++){const u=g/200,p=this.spline.getPointAt(u),x=this.spline.getTangentAt(u),z=new a(0,1,0).cross(x).normalize();s.push(p.clone().add(z.clone().multiplyScalar(.6))),n.push(p.clone().add(z.clone().multiplyScalar(-.6)))}const c=new F(s),r=new F(n),i={steps:200,radius:.1,radialSegments:8,closed:!0},f=new W(c,i.steps,i.radius,i.radialSegments,i.closed),l=new W(r,i.steps,i.radius,i.radialSegments,i.closed),d=new h(f,o),y=new h(l,o);d.castShadow=!0,y.castShadow=!0,this.scene.add(d),this.scene.add(y)}createSupports(){const t=new w({color:13421772,specular:16777215,shininess:30}),e=40;for(let o=0;o<e;o++){const s=o/e,n=this.spline.getPointAt(s),c=this.spline.getTangentAt(s);if(n.y>5.5){const r=n.y-.5,i=new V(.3,.5,r,8),f=new h(i,t);if(f.position.set(n.x,r/2,n.z),f.castShadow=!0,f.receiveShadow=!0,r>10){const y=r*.7,g=new V(.2,.2,r*.4,8),u=new h(g,t),p=Math.atan2(c.z,c.x);u.rotation.x=Math.PI/4,u.rotation.y=p,u.position.set(n.x,y,n.z),u.castShadow=!0,this.scene.add(u);const x=u.clone();x.rotation.y=p+Math.PI/2,this.scene.add(x)}const l=new V(.8,.8,.5,8),d=new h(l,t);d.position.set(n.x,.25,n.z),d.castShadow=!0,d.receiveShadow=!0,this.scene.add(f),this.scene.add(d)}}}getPointAtT(t){return this.spline.getPointAt(t%1)}getTangentAtT(t){return this.spline.getTangentAt(t%1)}}class ct{constructor(t,e){this.scene=t,this.track=e,this.cart=null,this.t=0,this.velocity=.001,this.acceleration=0,this.isMoving=!0,this.starParticles=[],this.createCart(),this.createStarTrail()}createCart(){const t=new I,e=new C(.8,16,16),o=new w({color:16752333,specular:16777215,shininess:50}),s=new h(e,o);s.scale.y=.5,s.scale.z=1.2,s.castShadow=!0,t.add(s);const n=new j(.25,5),c=new w({color:16768768,specular:16777215,shininess:100});[[-.4,-.3,.5],[.4,-.3,.5],[-.4,-.3,-.5],[.4,-.3,-.5]].forEach(G=>{const v=new h(n,c);v.rotation.y=Math.PI/2,v.position.set(...G),v.castShadow=!0,t.add(v)});const i=new I;i.position.z=.6,i.position.y=.1;const f=new C(.1,16,16),l=new w({color:0}),d=new h(f,l);d.position.set(-.2,0,0),i.add(d);const y=new h(f,l);y.position.set(.2,0,0),i.add(y);const g=new C(.08,16,16),u=new w({color:16744319}),p=new h(g,u);p.position.set(-.3,-.1,-.1),i.add(p);const x=new h(g,u);x.position.set(.3,-.1,-.1),i.add(x),t.add(i);const z=new B(.15),D=new w({color:16776960,specular:16777215,shininess:100});for(let G=0;G<3;G++){const v=new h(z,D);v.position.set((Math.random()-.5)*.5,.5+Math.random()*.3,(Math.random()-.5)*.5),v.rotation.y=Math.random()*Math.PI,t.add(v)}this.cart=t,this.scene.add(this.cart)}createStarTrail(){const t=new B(.1),e=new w({color:16776960,specular:16777215,shininess:100,transparent:!0,opacity:1});for(let o=0;o<10;o++){const s=new h(t,e.clone());s.visible=!1,this.starParticles.push({mesh:s,life:0,maxLife:1,offset:new a((Math.random()-.5)*.5,(Math.random()-.5)*.5,(Math.random()-.5)*.5)}),this.scene.add(s)}}updateStarTrail(){this.isMoving&&this.starParticles.forEach(t=>{t.life<=0&&Math.random()<.1&&(t.mesh.visible=!0,t.life=t.maxLife,t.mesh.position.copy(this.cart.position).add(t.offset)),t.life>0&&(t.life-=.02,t.mesh.material.opacity=t.life,t.mesh.position.y+=.05,t.mesh.rotation.y+=.1),t.life<=0&&(t.mesh.visible=!1)})}startMoving(){this.isMoving=!0,this.velocity=Math.max(.001,this.velocity)}stopMoving(){this.isMoving=!1,this.velocity=0,this.acceleration=0}update(){if(!this.isMoving)return;if(!this.track||!this.cart){console.warn("Track or cart not initialized");return}const t=8e-4,e=2e-4,o=.001,s=.008,n=.001,c=2;try{const r=this.track.getPointAtT(this.t);if(!r){console.warn("Invalid track point");return}const i=this.track.getTangentAtT(this.t);if(!i){console.warn("Invalid track tangent");return}const f=Math.atan2(Math.max(-1,Math.min(1,i.y)),Math.sqrt(i.x*i.x+i.z*i.z)),l=.05,d=this.t+l,y=Math.max(0,this.t-l),g=this.track.getPointAtT(d),u=this.track.getPointAtT(y);if(!g||!u){console.warn("Unable to calculate track curvature");return}const p=new a().subVectors(g,r),x=new a().subVectors(u,r),z=.01;if(p.length()<z||x.length()<z){this.velocity=Math.max(o,Math.min(s,this.velocity)),this.t+=this.velocity,this.cart.position.copy(r);return}p.normalize(),x.normalize();const D=Math.min(Math.PI/4,p.angleTo(x)),G=Math.min(5e-4,D*this.velocity*this.velocity*.08),v=Math.sin(f)*t-e-G;this.acceleration=Math.max(-n,Math.min(n,v));const X=this.velocity+this.acceleration;this.velocity=this.velocity*.95+X*.05,this.velocity=Math.max(o,Math.min(s,this.velocity));const N=this.cart.position.clone(),Z=this.velocity;if(this.t+=this.velocity,this.cart.position.copy(r),this.cart.position.distanceTo(N)>c){const O=N.clone().lerp(r,.1);this.cart.position.copy(O),this.velocity=Z*.8;return}const H=this.track.getPointAtT(this.t+l);if(H&&!H.equals(r)){this.cart.lookAt(H);const O=Math.PI/6,_=Math.min(Math.max(-O,D*1.2),O);this.cart.rotateZ(_)}this.updateStarTrail()}catch(r){console.error("Error updating cart:",r),this.velocity=o,this.acceleration=0}}getPosition(){return this.cart.position}getQuaternion(){return this.cart.quaternion}}class ht{constructor(t){this.scene=t,this.createGround(),this.createClouds(),this.createDecorations(),this.createGiantKirby()}createGround(){const t=new j(100,64),e=new w({color:10026904,specular:16777215,shininess:30});this.ground=new h(t,e),this.ground.rotation.x=-Math.PI/2,this.ground.receiveShadow=!0,this.scene.add(this.ground)}createClouds(){this.clouds=new I;const t=[{x:-30,y:30,z:-30},{x:40,y:35,z:20},{x:-20,y:25,z:40},{x:30,y:40,z:-40}],e=new w({color:16777215,specular:16777215,shininess:10,transparent:!0,opacity:.9});t.forEach(o=>{const s=this.createPuffyCloud(e);s.position.set(o.x,o.y,o.z),s.scale.set(5+Math.random()*3,3+Math.random()*2,4+Math.random()*3),this.clouds.add(s)}),this.scene.add(this.clouds)}createPuffyCloud(t){const e=new I,o=new C(1,16,16);return[{x:0,y:0,z:0},{x:1.2,y:.3,z:0},{x:-1,y:.2,z:0},{x:.5,y:.8,z:.5},{x:-.5,y:.7,z:-.5}].forEach(n=>{const c=new h(o,t);c.position.set(n.x,n.y,n.z),e.add(c)}),e}createDecorations(){const t=new B(1),e=new w({color:16776960,specular:16777215,shininess:100});for(let o=0;o<20;o++){const s=new h(t,e),n=o/20*Math.PI*2,c=60+Math.random()*20;s.position.x=Math.cos(n)*c,s.position.y=10+Math.random()*30,s.position.z=Math.sin(n)*c,s.scale.set(.5,.5,.5),s.rotation.y=Math.random()*Math.PI,this.scene.add(s)}}createGiantKirby(){this.kirby=new I;const t=new C(15,32,32),e=new w({color:16758749,specular:16777215,shininess:30}),o=new h(t,e);this.kirby.add(o);const s=new C(2,16,16),n=new w({color:0}),c=new h(s,n);c.position.set(-4,4,13),c.scale.y=1.5,this.kirby.add(c);const r=new h(s,n);r.position.set(4,4,13),r.scale.y=1.5,this.kirby.add(r);const i=new C(2.4,16,16),f=new w({color:16752333,specular:16777215,shininess:20}),l=new h(i,f);l.position.set(-10,-2,10),this.kirby.add(l);const d=new h(i,f);d.position.set(10,-2,10),this.kirby.add(d),this.kirby.position.set(-80,60,-100),this.scene.add(this.kirby);const y=new Y(16777215,1,200);y.position.set(-80,80,-80),this.scene.add(y)}update(t){if(this.clouds.children.forEach((e,o)=>{e.position.x+=Math.sin(Date.now()*.001+o)*.02,e.position.y+=Math.cos(Date.now()*.001+o)*.01}),this.kirby){const e=Date.now()*.001;this.kirby.position.y=60+Math.sin(e*.5)*10,this.kirby.position.x=-80+Math.sin(e*.3)*30,this.kirby.position.z=-100+Math.cos(e*.4)*30,this.kirby.rotation.y=Math.sin(e*.5)*.3,this.kirby.rotation.x=Math.sin(e*.3)*.2,this.kirby.rotation.z=Math.cos(e*.4)*.2}}}class lt{constructor(t){this.cart=t,this.sketch=new at(e=>{e.setup=()=>this.setup(e),e.draw=()=>this.draw(e),e.windowResized=()=>this.windowResized(e)})}setup(t){this.canvas=t.createCanvas(t.windowWidth,t.windowHeight),this.canvas.style("position","fixed"),this.canvas.style("top","0"),this.canvas.style("left","0"),this.canvas.style("pointer-events","none"),this.canvas.style("z-index","100")}draw(t){t.clear();const e=this.cart.getPosition(),o=this.cart.velocity,s=e?e.y.toFixed(1):"0.0",n=(o*100).toFixed(1);t.push(),t.fill(255,255,255,200),t.noStroke(),t.rect(20,20,200,100,10),t.fill(0),t.textSize(16),t.textAlign(t.LEFT),t.text("Height: "+s+" m",35,50),t.text("Speed: "+n+" km/h",35,80),t.pop();const c=30,r=200;t.push(),t.translate(t.width-60,t.height-50),t.rotate(-t.PI/2),t.fill(200),t.rect(0,0,r,20,10);const i=Math.min(e?e.y/c:0,1);t.fill(100,200,255),t.rect(0,0,r*i,20,10),t.pop();const f=.5,l=200;t.push(),t.translate(t.width-l-50,t.height-50),t.fill(200),t.rect(0,0,l,20,10);const d=Math.min(o/f,1);t.fill(255,100,100),t.rect(0,0,l*d,20,10),t.pop()}windowResized(t){t.resizeCanvas(t.windowWidth,t.windowHeight)}}const T=new $;T.background=new tt(8900331);const S=new et(75,window.innerWidth/window.innerHeight,.1,1e3);S.position.set(0,15,30);const L=new st({antialias:!0});L.setSize(window.innerWidth,window.innerHeight);L.shadowMap.enabled=!0;L.shadowMap.type=nt;document.body.appendChild(L.domElement);const b=document.createElement("div");b.style.position="fixed";b.style.bottom="20px";b.style.left="50%";b.style.transform="translateX(-50%)";b.style.zIndex="1000";b.style.display="flex";b.style.gap="10px";const k=document.createElement("button");k.textContent="🚂 Start";k.style.padding="10px 20px";k.style.fontSize="18px";k.style.borderRadius="25px";k.style.border="none";k.style.backgroundColor="#ffb7dd";k.style.cursor="pointer";k.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)";const P=document.createElement("button");P.textContent="🛑 Stop";P.style.padding="10px 20px";P.style.fontSize="18px";P.style.borderRadius="25px";P.style.border="none";P.style.backgroundColor="#ff9999";P.style.cursor="pointer";P.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)";b.appendChild(k);b.appendChild(P);document.body.appendChild(b);const dt=new ot(4210752,1);T.add(dt);const M=new it(16777215,1);M.position.set(50,100,50);M.castShadow=!0;M.shadow.mapSize.width=2048;M.shadow.mapSize.height=2048;M.shadow.camera.near=.5;M.shadow.camera.far=500;M.shadow.camera.left=-100;M.shadow.camera.right=100;M.shadow.camera.top=100;M.shadow.camera.bottom=-100;T.add(M);const ft=new ht(T),ut=new rt(T),E=new ct(T,ut),R=new lt(E),wt=new a(0,10,25),yt=new a(0,2,-15),U=.03;let A=new a,q=new a,K=!0;k.addEventListener("click",()=>{K=!0,E.startMoving()});P.addEventListener("click",()=>{K=!1,E.stopMoving()});function Q(){requestAnimationFrame(Q),K&&E.update(),ft.update(E.getPosition());const m=E.getPosition();if(!m||!isFinite(m.x)||!isFinite(m.y)||!isFinite(m.z)){console.warn("Invalid cart position detected");return}const t=m.clone().add(wt),e=m.clone().add(yt),o=2;if(A.length()===0&&(A.copy(t),q.copy(e)),t.distanceTo(A)>o){const n=t.clone().sub(A).normalize();t.copy(A).add(n.multiplyScalar(o))}S.position.lerp(t,U),q.lerp(e,U),S.lookAt(q),A.copy(S.position),S.position.y=Math.max(8,Math.min(50,S.position.y)),L.render(T,S)}window.addEventListener("resize",()=>{S.aspect=window.innerWidth/window.innerHeight,S.updateProjectionMatrix(),L.setSize(window.innerWidth,window.innerHeight),R&&R.sketch&&R.sketch._setupDone&&R.windowResized(R.sketch)});Q();
